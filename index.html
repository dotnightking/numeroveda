<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NumeroVeda ‚Äî Chaldean Numerology Engine</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0f;
  --surface: #12121a;
  --surface2: #1a1a26;
  --border: #2a2a3a;
  --text: #e8e6e3;
  --text2: #9a96a0;
  --gold: #d4a853;
  --gold2: #b8912f;
  --gold-glow: rgba(212,168,83,0.15);
  --red: #e85454;
  --red-glow: rgba(232,84,84,0.12);
  --green: #4ade80;
  --green-glow: rgba(74,222,128,0.12);
  --blue: #60a5fa;
  --purple: #a78bfa;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
}

.noise {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events: none; z-index: 9999;
}

.container {
  max-width: 880px; margin: 0 auto; padding: 20px;
}

header {
  text-align: center; padding: 50px 20px 30px;
  position: relative;
}

header::before {
  content: ''; position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
  width: 120px; height: 1px; background: linear-gradient(90deg, transparent, var(--gold), transparent);
}

.logo {
  font-family: 'Cormorant Garamond', serif;
  font-size: 42px; font-weight: 300; letter-spacing: 8px;
  color: var(--gold);
  text-transform: uppercase;
  margin-bottom: 8px;
}

.tagline {
  font-size: 12px; letter-spacing: 4px; text-transform: uppercase;
  color: var(--text2); font-weight: 300;
}

.badge {
  display: inline-block; margin-top: 14px; padding: 4px 14px;
  border: 1px solid var(--border); border-radius: 20px;
  font-size: 10px; letter-spacing: 2px; color: var(--text2);
  text-transform: uppercase;
}

/* Input Section */
.input-section {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 36px;
  margin: 30px 0;
  position: relative;
  overflow: hidden;
}

.input-section::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, var(--gold2), transparent);
}

.input-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
}

@media (max-width: 600px) {
  .input-grid { grid-template-columns: 1fr; }
}

.field { display: flex; flex-direction: column; gap: 6px; }

.field label {
  font-size: 10px; letter-spacing: 2px; text-transform: uppercase;
  color: var(--text2); font-weight: 500;
}

.field input {
  background: var(--bg); border: 1px solid var(--border);
  border-radius: 8px; padding: 14px 16px;
  color: var(--text); font-family: 'DM Sans', sans-serif;
  font-size: 15px; outline: none; transition: border-color 0.3s;
}

.field input:focus { border-color: var(--gold); }

.field input::placeholder { color: #4a4656; }

.field-full { grid-column: 1 / -1; }

.btn {
  grid-column: 1 / -1;
  background: linear-gradient(135deg, var(--gold2), var(--gold));
  border: none; border-radius: 8px; padding: 16px;
  color: #0a0a0f; font-family: 'DM Sans', sans-serif;
  font-size: 13px; font-weight: 600; letter-spacing: 3px;
  text-transform: uppercase; cursor: pointer;
  transition: all 0.3s; margin-top: 8px;
}

.btn:hover { transform: translateY(-1px); box-shadow: 0 8px 30px rgba(212,168,83,0.25); }

/* Results */
.results { display: none; margin-top: 0; }
.results.active { display: block; animation: fadeUp 0.6s ease; }

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Score Ring */
.score-hero {
  text-align: center; padding: 40px 20px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  margin-bottom: 20px;
  position: relative;
}

.score-ring-wrap {
  position: relative; width: 200px; height: 200px;
  margin: 0 auto 24px;
}

.score-ring-wrap svg { transform: rotate(-90deg); }

.score-ring-bg { fill: none; stroke: var(--surface2); stroke-width: 8; }
.score-ring-fill { fill: none; stroke-width: 8; stroke-linecap: round; transition: stroke-dashoffset 1.5s ease; }

.score-number {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
  font-family: 'Cormorant Garamond', serif; font-size: 56px; font-weight: 300;
}

.score-label {
  font-size: 11px; letter-spacing: 3px; text-transform: uppercase;
  color: var(--text2); margin-bottom: 4px;
}

.score-verdict {
  font-family: 'Cormorant Garamond', serif; font-size: 22px; font-weight: 400;
  margin-top: 4px;
}

/* Cards */
.card-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 16px;
  margin-bottom: 16px;
}

@media (max-width: 600px) { .card-grid { grid-template-columns: 1fr; } }

.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  position: relative;
  overflow: hidden;
}

.card-title {
  font-size: 10px; letter-spacing: 2px; text-transform: uppercase;
  color: var(--text2); margin-bottom: 12px; font-weight: 500;
}

.card-number {
  font-family: 'Cormorant Garamond', serif;
  font-size: 44px; font-weight: 300; line-height: 1;
  margin-bottom: 4px;
}

.card-planet {
  font-size: 13px; color: var(--gold); margin-bottom: 8px;
}

.card-rate {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px; padding: 3px 10px;
  border-radius: 4px; display: inline-block;
}

.rate-good { background: var(--green-glow); color: var(--green); }
.rate-bad { background: var(--red-glow); color: var(--red); }
.rate-mid { background: rgba(255,255,255,0.05); color: var(--text2); }

/* DC Combo */
.dc-section {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 28px;
  margin-bottom: 16px;
}

.dc-combo-display {
  display: flex; align-items: center; gap: 16px;
  justify-content: center; margin: 16px 0;
}

.dc-num {
  font-family: 'Cormorant Garamond', serif;
  font-size: 52px; font-weight: 300;
}

.dc-sep {
  font-size: 20px; color: var(--text2);
}

.dc-label {
  font-size: 10px; letter-spacing: 1px; color: var(--text2);
  text-transform: uppercase; text-align: center;
}

/* Name Analysis */
.name-breakdown {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 28px;
  margin-bottom: 16px;
}

.name-table {
  width: 100%; border-collapse: collapse; margin-top: 16px;
}

.name-table th {
  text-align: left; font-size: 10px; letter-spacing: 1.5px;
  text-transform: uppercase; color: var(--text2); padding: 8px 12px;
  border-bottom: 1px solid var(--border); font-weight: 500;
}

.name-table td {
  padding: 10px 12px; border-bottom: 1px solid rgba(255,255,255,0.03);
  font-size: 14px;
}

.name-table .mono {
  font-family: 'JetBrains Mono', monospace; font-size: 13px;
}

/* Meter bar */
.meter {
  height: 6px; background: var(--surface2); border-radius: 3px;
  overflow: hidden; width: 100px; display: inline-block; vertical-align: middle;
  margin-left: 8px;
}

.meter-fill {
  height: 100%; border-radius: 3px; transition: width 1s ease;
}

/* Recommendations */
.reco-section {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 28px;
  margin-bottom: 16px;
}

.reco-item {
  padding: 12px 0;
  border-bottom: 1px solid rgba(255,255,255,0.03);
  display: flex; gap: 12px; align-items: flex-start;
}

.reco-item:last-child { border: none; }

.reco-icon {
  width: 28px; height: 28px; border-radius: 6px;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px; flex-shrink: 0; margin-top: 2px;
}

.reco-good { background: var(--green-glow); }
.reco-warn { background: var(--red-glow); }
.reco-info { background: var(--gold-glow); }

.reco-text { font-size: 14px; line-height: 1.6; color: var(--text); }
.reco-text strong { color: var(--gold); font-weight: 500; }

/* Disclaimer */
.disclaimer {
  text-align: center; padding: 30px 20px;
  font-size: 11px; color: #5a5666; line-height: 1.6;
  border-top: 1px solid var(--border);
  margin-top: 20px;
}

.disclaimer strong { color: var(--text2); }

/* Name Suggest */
.suggest-section {
  background: linear-gradient(135deg, rgba(212,168,83,0.06), rgba(212,168,83,0.02));
  border: 1px solid rgba(212,168,83,0.2);
  border-radius: 12px;
  padding: 28px;
  margin-bottom: 16px;
}

.suggest-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 8px; margin-top: 16px;
}

.suggest-chip {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 8px; text-align: center;
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
}

.suggest-chip.best {
  border-color: var(--gold);
  background: var(--gold-glow);
  color: var(--gold);
}

/* Name Correction Section */
.correction-section {
  background: linear-gradient(135deg, rgba(74,222,128,0.04), rgba(74,222,128,0.01));
  border: 1px solid rgba(74,222,128,0.15);
  border-radius: 12px;
  padding: 28px;
  margin-bottom: 16px;
}

.correction-header {
  display: flex; align-items: center; gap: 12px; margin-bottom: 16px;
}

.correction-header h3 {
  font-family: 'Cormorant Garamond', serif;
  font-size: 20px; font-weight: 400; color: var(--text);
}

.corr-table {
  width: 100%; border-collapse: collapse;
}

.corr-table th {
  text-align: left; font-size: 9px; letter-spacing: 1.5px;
  text-transform: uppercase; color: var(--text2); padding: 8px 10px;
  border-bottom: 1px solid var(--border); font-weight: 500;
}

.corr-table td {
  padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.03);
  font-size: 13px;
}

.corr-name {
  font-weight: 500; color: var(--text);
}

.corr-change {
  font-size: 11px; color: var(--text2); margin-top: 2px;
  font-style: italic;
}

.corr-boost {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px; color: var(--green); font-weight: 500;
}

.corr-tag {
  display: inline-block; padding: 2px 8px; border-radius: 3px;
  font-size: 10px; letter-spacing: 1px; text-transform: uppercase;
  font-weight: 500;
}

.corr-tag-add { background: rgba(96,165,250,0.12); color: var(--blue); }
.corr-tag-remove { background: rgba(232,84,84,0.12); color: var(--red); }
.corr-tag-swap { background: rgba(167,139,250,0.12); color: var(--purple); }
.corr-tag-double { background: rgba(212,168,83,0.12); color: var(--gold); }

.corr-original {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 14px 18px;
  margin-bottom: 16px;
  display: flex; justify-content: space-between; align-items: center;
}

.corr-original-name {
  font-size: 15px; font-weight: 500;
}

.corr-original-score {
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px; color: var(--text2);
}

.corr-best-badge {
  display: inline-block; padding: 2px 8px; border-radius: 3px;
  font-size: 9px; letter-spacing: 1px; text-transform: uppercase;
  background: var(--green-glow); color: var(--green); font-weight: 600;
  margin-left: 8px;
}

.corr-note {
  margin-top: 16px; padding: 14px 18px;
  background: rgba(212,168,83,0.06);
  border: 1px solid rgba(212,168,83,0.12);
  border-radius: 8px;
  font-size: 12px; color: var(--text2); line-height: 1.7;
}

.corr-note strong { color: var(--gold); }

.corr-letter-grid {
  display: flex; gap: 3px; flex-wrap: wrap; margin: 8px 0;
}

.corr-letter {
  width: 28px; height: 32px; display: flex; align-items: center; justify-content: center;
  background: var(--surface2); border: 1px solid var(--border); border-radius: 4px;
  font-family: 'JetBrains Mono', monospace; font-size: 14px;
}

.corr-letter.added {
  border-color: var(--green); background: var(--green-glow); color: var(--green);
}

.corr-letter.removed {
  border-color: var(--red); background: var(--red-glow); color: var(--red);
  text-decoration: line-through;
}

.corr-letter.changed {
  border-color: var(--purple); background: rgba(167,139,250,0.12); color: var(--purple);
}
</style>
</head>
<body>
<div class="noise"></div>
<div class="container">
  <header>
    <div class="logo">NumeroVeda</div>
    <div class="tagline">Chaldean Numerology Engine</div>
    <div class="badge">Validated against 257 real people</div>
  </header>

  <div class="input-section">
    <div class="input-grid">
      <div class="field">
        <label>Name (as commonly known)</label>
        <input type="text" id="nameInput" placeholder="e.g. Virat Kohli">
      </div>
      <div class="field">
        <label>Date of Birth</label>
        <input type="date" id="dobInput">
      </div>
      <div class="field field-full" id="firstNameField" style="display:none">
        <label>First Name (if different from above)</label>
        <input type="text" id="firstNameInput" placeholder="Optional ‚Äî if commonly known by surname only">
      </div>
      <button class="btn" onclick="analyze()">Reveal Your Numbers</button>
    </div>
  </div>

  <div class="results" id="results"></div>
</div>

<script>
const CHALDEAN = {A:1,B:2,C:3,D:4,E:5,F:8,G:3,H:5,I:1,J:1,K:2,L:3,M:4,N:5,O:7,P:8,Q:1,R:2,S:3,T:4,U:6,V:6,W:6,X:5,Y:1,Z:7};
const VOWELS = new Set('AEIOU');
const PLANETS = {1:'Sun ‚òÄÔ∏è',2:'Moon üåô',3:'Jupiter ‚ôÉ',4:'Rahu ‚òä',5:'Mercury ‚òø',6:'Venus ‚ôÄ',7:'Ketu ‚òã',8:'Saturn ‚ôÑ',9:'Mars ‚ôÇ'};

// SUCCESS RATES ‚Äî validated against 257 people
const DRIVER_RATES = {1:66,2:50,3:64,4:68,5:78,6:68,7:52,8:58,9:55};
const CONDUCTOR_RATES = {1:72,2:52,3:50,4:75,5:61,6:73,7:70,8:65,9:46};
const NAME_ROOT_RATES = {1:73,2:60,3:56,4:59,5:69,6:54,7:64,8:72,9:61};
const SOUL_RATES = {1:64,2:77,3:66,4:59,5:47,6:58,7:65,8:76,9:72};
const PERS_RATES = {1:45,2:63,3:47,4:68,5:70,6:57,7:71,8:59,9:72};

// DC COMBO RATES ‚Äî from 257-person validation (only combos with 3+ people)
const DC_RATES = {
  '1-1':83,'1-3':50,'1-4':100,'1-5':66,'1-7':57,'1-8':80,'1-9':50,
  '2-1':33,'2-2':33,'2-3':33,'2-5':33,'2-6':66,'2-7':80,'2-8':66,'2-9':25,
  '3-1':75,'3-2':66,'3-3':33,'3-4':57,'3-5':85,'3-6':66,'3-8':60,
  '4-1':100,'4-2':60,'4-4':75,'4-5':66,'4-7':40,
  '5-2':100,'5-3':75,'5-4':66,'5-6':80,'5-8':25,'5-9':100,
  '6-1':75,'6-2':66,'6-3':66,'6-4':100,'6-7':66,'6-8':50,
  '7-1':66,'7-4':100,'7-7':66,'7-8':66,'7-9':25,
  '8-2':66,'8-3':50,'8-5':20,'8-7':100,'8-8':80,'8-9':50,
  '9-1':66,'9-5':75,'9-9':25
};

function reduce(t) {
  while (t > 9 && t !== 11 && t !== 22 && t !== 33) {
    t = String(t).split('').reduce((a,b) => a + parseInt(b), 0);
  }
  return t;
}

function calcName(name) {
  const clean = name.toUpperCase().replace(/[^A-Z]/g, '');
  let total = 0, vowels = 0;
  for (const c of clean) {
    const v = CHALDEAN[c] || 0;
    total += v;
    if (VOWELS.has(c)) vowels += v;
  }
  return {
    total, root: reduce(total), compound: total,
    soul: reduce(vowels), pers: reduce(total - vowels),
    letters: clean
  };
}

function driver(day) {
  let d = day;
  while (d > 9) d = String(d).split('').reduce((a,b) => a + parseInt(b), 0);
  return d;
}

function conductor(day, month, year) {
  const total = String(day).split('').concat(String(month).split(''), String(year).split(''))
    .reduce((a,b) => a + parseInt(b), 0);
  let c = total;
  while (c > 9) c = String(c).split('').reduce((a,b) => a + parseInt(b), 0);
  return c;
}

function rateClass(rate) {
  if (rate >= 70) return 'rate-good';
  if (rate <= 45) return 'rate-bad';
  return 'rate-mid';
}

function rateLabel(rate) {
  if (rate >= 75) return 'Strong';
  if (rate >= 65) return 'Good';
  if (rate >= 55) return 'Average';
  if (rate >= 45) return 'Weak';
  return 'Caution';
}

function meterColor(rate) {
  if (rate >= 70) return 'var(--green)';
  if (rate >= 55) return 'var(--gold)';
  return 'var(--red)';
}

function getPlanet(n) {
  const r = n > 9 ? reduce(n) : n;
  return PLANETS[r] || '';
}

function getVerdict(score) {
  if (score >= 72) return { text: 'Exceptional Alignment', color: 'var(--green)' };
  if (score >= 65) return { text: 'Strong Vibration', color: 'var(--green)' };
  if (score >= 58) return { text: 'Favorable Energy', color: 'var(--gold)' };
  if (score >= 52) return { text: 'Mixed Signals', color: 'var(--text2)' };
  if (score >= 45) return { text: 'Challenging Pattern', color: 'var(--red)' };
  return { text: 'Significant Friction', color: 'var(--red)' };
}

function suggestBestRoots(drv, cnd) {
  const roots = [];
  for (let r = 1; r <= 9; r++) {
    const nameRate = NAME_ROOT_RATES[r] || 60;
    roots.push({ root: r, rate: nameRate, planet: PLANETS[r] });
  }
  roots.sort((a, b) => b.rate - a.rate);
  return roots;
}

function nameScore(name) {
  const c = calcName(name);
  const r = c.root > 9 ? reduce(c.root) : c.root;
  const s = c.soul > 9 ? reduce(c.soul) : c.soul;
  const p = c.pers > 9 ? reduce(c.pers) : c.pers;
  return {
    score: ((NAME_ROOT_RATES[r]||60) + (SOUL_RATES[s]||60) + (PERS_RATES[p]||60)) / 3,
    root: r, soul: s, pers: p, compound: c.total
  };
}

function generateCorrections(name) {
  const original = name.trim();
  const origData = nameScore(original);
  const suggestions = new Map();
  const parts = original.split(/\s+/);

  const SIMILAR = {
    'C':['K','S'],'K':['C','Q'],'S':['Z','C'],'Z':['S'],
    'V':['W'],'W':['V'],'I':['Y','EE'],'Y':['I'],
    'J':['G'],'G':['J'],'T':['TH','D'],'D':['T'],
    'F':['PH'],'N':['NN'],'A':['AA'],'E':['EE','I'],
    'R':['RR'],'L':['LL']
  };

  function tryCandidate(candidate, method, tag) {
    if (candidate === original) return;
    if (candidate.replace(/\s+/g,'').length < 3) return;
    const data = nameScore(candidate);
    if (data.score > origData.score + 0.5 && !suggestions.has(candidate)) {
      suggestions.set(candidate, { ...data, method, tag });
    }
  }

  for (let pi = 0; pi < parts.length; pi++) {
    const part = parts[pi];
    const mk = (newPart) => { const p = [...parts]; p[pi] = newPart; return p.join(' '); };

    // 1. Add letter at end
    for (const ch of 'aehisn') {
      tryCandidate(mk(part + ch), `Add "${ch}" after ${part}`, 'add');
    }

    // 2. Double consonant
    for (let i = 0; i < part.length; i++) {
      if (!VOWELS.has(part[i].toUpperCase()) && /[a-zA-Z]/.test(part[i])) {
        tryCandidate(mk(part.slice(0,i+1) + part[i] + part.slice(i+1)), `Double "${part[i]}" ‚Üí "${part[i]+part[i]}"`, 'double');
      }
    }

    // 3. Double vowel
    for (let i = 0; i < part.length; i++) {
      if (VOWELS.has(part[i].toUpperCase())) {
        tryCandidate(mk(part.slice(0,i+1) + part[i] + part.slice(i+1)), `Double "${part[i]}" ‚Üí "${part[i]+part[i]}"`, 'double');
      }
    }

    // 4. Remove a letter (word must stay 3+)
    if (part.length >= 4) {
      for (let i = 0; i < part.length; i++) {
        const nw = part.slice(0,i) + part.slice(i+1);
        if (nw.length >= 3) tryCandidate(mk(nw), `Remove "${part[i]}" from ${part}`, 'remove');
      }
    }

    // 5. Insert at each position
    for (let i = 1; i < part.length; i++) {
      for (const ch of 'aheiou') {
        tryCandidate(mk(part.slice(0,i) + ch + part.slice(i)), `Insert "${ch}" in ${part}`, 'add');
      }
    }

    // 6. Replace with similar sounding
    for (let i = 0; i < part.length; i++) {
      const upper = part[i].toUpperCase();
      if (SIMILAR[upper]) {
        for (const rep of SIMILAR[upper]) {
          const isFirst = i === 0;
          const repFormatted = isFirst ? rep[0].toUpperCase() + rep.slice(1).toLowerCase() : rep.toLowerCase();
          tryCandidate(mk(part.slice(0,i) + repFormatted + part.slice(i+1)), `"${part[i]}" ‚Üí "${repFormatted}"`, 'swap');
        }
      }
    }
  }

  // Sort by score and deduplicate by root+soul+pers combo
  let sorted = [...suggestions.entries()]
    .sort((a, b) => b[1].score - a[1].score);
  
  // Keep only unique root/soul/pers combos (best of each)
  const seenCombos = new Set();
  const unique = [];
  for (const [name, data] of sorted) {
    const key = `${data.root}-${data.soul}-${data.pers}`;
    if (!seenCombos.has(key)) {
      seenCombos.add(key);
      unique.push([name, data]);
    }
    if (unique.length >= 10) break;
  }

  return { suggestions: unique, original: origData };
}

function buildCorrectionHTML(name) {
  const { suggestions, original } = generateCorrections(name);
  
  if (suggestions.length === 0) {
    return `
      <div class="correction-section">
        <div class="correction-header"><h3>‚úèÔ∏è Name Correction Analysis</h3></div>
        <div class="corr-original">
          <span class="corr-original-name">${name}</span>
          <span class="corr-original-score">Score: ${original.score.toFixed(1)}</span>
        </div>
        <div style="text-align:center;padding:20px;color:var(--text2);font-size:14px">
          ‚úÖ Your name is already well-optimized! No significant improvements found through spelling changes.
        </div>
      </div>`;
  }

  const tagClass = {add:'corr-tag-add', remove:'corr-tag-remove', swap:'corr-tag-swap', double:'corr-tag-double'};
  const tagLabel = {add:'ADD', remove:'REMOVE', swap:'SWAP', double:'DOUBLE'};
  const best = suggestions[0];

  let rows = suggestions.map(([sName, data], i) => {
    const boost = data.score - original.score;
    return `<tr>
      <td>
        <div class="corr-name">${sName}${i === 0 ? '<span class="corr-best-badge">Best Match</span>' : ''}</div>
        <div class="corr-change">${data.method}</div>
      </td>
      <td><span class="corr-tag ${tagClass[data.tag]||''}">${tagLabel[data.tag]||data.tag}</span></td>
      <td class="mono">${data.root}</td>
      <td class="mono">${data.soul}</td>
      <td class="mono">${data.pers}</td>
      <td class="mono">${data.compound}</td>
      <td class="corr-boost">+${boost.toFixed(1)}</td>
      <td><span class="card-rate ${rateClass(data.score)}">${data.score.toFixed(0)}%</span></td>
    </tr>`;
  }).join('');

  return `
    <div class="correction-section">
      <div class="correction-header"><h3>‚úèÔ∏è Name Correction Suggestions</h3></div>
      
      <div class="corr-original">
        <div>
          <span class="corr-original-name">Current: ${name}</span>
          <span style="font-size:12px;color:var(--text2);margin-left:8px">R=${original.root} S=${original.soul} P=${original.pers}</span>
        </div>
        <span class="corr-original-score">Name Score: ${original.score.toFixed(1)}</span>
      </div>

      <table class="corr-table">
        <thead>
          <tr>
            <th>Suggested Spelling</th>
            <th>Type</th>
            <th>Root</th>
            <th>Soul</th>
            <th>Pers</th>
            <th>Comp</th>
            <th>Boost</th>
            <th>Score</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>

      <div class="corr-note">
        <strong>How this works:</strong> We test hundreds of spelling variations ‚Äî adding, removing, doubling, or swapping letters ‚Äî and rank them by their numerological score 
        (weighted average of Name Root, Soul Urge, and Personality success rates from 257 people).<br><br>
        <strong>Important:</strong> These are <em>algorithmic suggestions</em> based on statistical patterns. For significant name changes (legal, branding, etc.), 
        consult a professional numerologist who can also factor in your complete birth chart, current planetary periods, and personal circumstances. 
        Minor adjustments like adding/doubling a letter are low-risk and commonly practiced.
      </div>
    </div>`;
}

function analyze() {
  const name = document.getElementById('nameInput').value.trim();
  const dobEl = document.getElementById('dobInput');
  if (!name || !dobEl.value) { alert('Please enter both name and date of birth'); return; }

  const [year, month, day] = dobEl.value.split('-').map(Number);
  const drv = driver(day);
  const cnd = conductor(day, month, year);
  const cn = calcName(name);
  const dcCombo = `${drv}-${cnd}`;

  // Rates
  const drvRate = DRIVER_RATES[drv] || 60;
  const cndRate = CONDUCTOR_RATES[cnd] || 60;
  const dcRate = DC_RATES[dcCombo] || null;
  const nameRootRate = NAME_ROOT_RATES[cn.root > 9 ? reduce(cn.root) : cn.root] || 60;
  const soulRate = SOUL_RATES[cn.soul > 9 ? reduce(cn.soul) : cn.soul] || 60;
  const persRate = PERS_RATES[cn.pers > 9 ? reduce(cn.pers) : cn.pers] || 60;

  // Composite score
  const scores = [drvRate, cndRate, nameRootRate, soulRate, persRate];
  if (dcRate !== null) scores.push(dcRate);
  const composite = Math.round(scores.reduce((a,b) => a+b, 0) / scores.length);
  const verdict = getVerdict(composite);

  // Ring percentage
  const ringPct = Math.min(100, Math.max(0, (composite - 20) * 1.25));
  const circumference = 2 * Math.PI * 88;
  const dashOffset = circumference * (1 - ringPct / 100);

  // Recommendations
  const recos = [];
  if (drvRate >= 70) recos.push({type:'good', text:`Your <strong>Driver ${drv} (${getPlanet(drv)})</strong> carries strong energy ‚Äî ${drvRate}% success correlation in our data. This is your natural personality vibration.`});
  else if (drvRate <= 50) recos.push({type:'warn', text:`Your <strong>Driver ${drv} (${getPlanet(drv)})</strong> showed only ${drvRate}% success correlation. This doesn't determine your fate ‚Äî but be aware of tendencies toward isolation or scattered energy.`});

  if (cndRate >= 70) recos.push({type:'good', text:`<strong>Conductor ${cnd} (${getPlanet(cnd)})</strong> is one of the strongest life paths ‚Äî ${cndRate}% success rate across 257 people.`});
  else if (cndRate <= 50) recos.push({type:'warn', text:`<strong>Conductor ${cnd} (${getPlanet(cnd)})</strong> showed only ${cndRate}% success correlation. People with this life path may face more karmic challenges ‚Äî awareness is key.`});

  if (dcRate !== null) {
    if (dcRate >= 80) recos.push({type:'good', text:`Your <strong>Driver-Conductor combination (${dcCombo})</strong> is exceptional ‚Äî ${dcRate}% success rate! This is one of the strongest pairs in Chaldean numerology.`});
    else if (dcRate <= 33) recos.push({type:'warn', text:`Your <strong>DC combination (${dcCombo})</strong> showed only ${dcRate}% success in our data. This combination may create inner tension between personality and destiny.`});
  }

  if (soulRate >= 70) recos.push({type:'good', text:`Name's <strong>Soul Urge ${cn.soul}</strong> (from vowels) has strong alignment ‚Äî ${soulRate}% correlation. Your inner desires resonate well.`});
  else if (soulRate <= 50) recos.push({type:'warn', text:`Name's <strong>Soul Urge ${cn.soul}</strong> showed weaker results (${soulRate}%). Consider if a name variation might shift the vowel energy.`});

  if (persRate >= 70) recos.push({type:'good', text:`Name's <strong>Personality ${cn.pers}</strong> (from consonants) is strong at ${persRate}%. The impression you make on others works in your favor.`});
  else if (persRate <= 50) recos.push({type:'warn', text:`Name's <strong>Personality ${cn.pers}</strong> showed only ${persRate}% correlation. The outer impression your name creates may face friction.`});

  recos.push({type:'info', text:`Your name <strong>"${name}"</strong> totals <strong>${cn.total}</strong> (Compound) ‚Üí Root <strong>${cn.root}</strong>. In Chaldean tradition, the compound number carries its own significance beyond the root.`});

  // Best name roots for this DOB
  const bestRoots = suggestBestRoots(drv, cnd);

  const html = `
    <div class="score-hero">
      <div class="score-label">Composite Numerology Score</div>
      <div class="score-ring-wrap">
        <svg width="200" height="200" viewBox="0 0 200 200">
          <circle class="score-ring-bg" cx="100" cy="100" r="88"/>
          <circle class="score-ring-fill" cx="100" cy="100" r="88"
            stroke="${verdict.color}"
            stroke-dasharray="${circumference}"
            stroke-dashoffset="${dashOffset}"/>
        </svg>
        <div class="score-number" style="color:${verdict.color}">${composite}</div>
      </div>
      <div class="score-verdict" style="color:${verdict.color}">${verdict.text}</div>
      <div style="margin-top:8px;font-size:12px;color:var(--text2)">Based on Driver-Conductor, Name Root, Soul Urge & Personality analysis</div>
    </div>

    <div class="card-grid">
      <div class="card">
        <div class="card-title">Driver (Psychic) Number</div>
        <div class="card-number">${drv}</div>
        <div class="card-planet">${getPlanet(drv)}</div>
        <span class="card-rate ${rateClass(drvRate)}">${drvRate}% ‚Äî ${rateLabel(drvRate)}</span>
        <div class="meter"><div class="meter-fill" style="width:${drvRate}%;background:${meterColor(drvRate)}"></div></div>
        <div style="margin-top:8px;font-size:12px;color:var(--text2)">Born on ${day}${day===1||day===21||day===31?'st':day===2||day===22?'nd':day===3||day===23?'rd':'th'}</div>
      </div>
      <div class="card">
        <div class="card-title">Conductor (Destiny) Number</div>
        <div class="card-number">${cnd}</div>
        <div class="card-planet">${getPlanet(cnd)}</div>
        <span class="card-rate ${rateClass(cndRate)}">${cndRate}% ‚Äî ${rateLabel(cndRate)}</span>
        <div class="meter"><div class="meter-fill" style="width:${cndRate}%;background:${meterColor(cndRate)}"></div></div>
        <div style="margin-top:8px;font-size:12px;color:var(--text2)">Full DOB sum</div>
      </div>
    </div>

    <div class="dc-section">
      <div class="card-title" style="text-align:center">Driver‚ÄìConductor Combination</div>
      <div class="dc-combo-display">
        <div>
          <div class="dc-num">${drv}</div>
          <div class="dc-label">Driver</div>
        </div>
        <div class="dc-sep">√ó</div>
        <div>
          <div class="dc-num">${cnd}</div>
          <div class="dc-label">Conductor</div>
        </div>
        <div class="dc-sep">=</div>
        <div>
          <div class="dc-num" style="color:${dcRate ? (dcRate >= 70 ? 'var(--green)' : dcRate <= 40 ? 'var(--red)' : 'var(--gold)') : 'var(--text2)'}">${dcRate !== null ? dcRate + '%' : '‚Äî'}</div>
          <div class="dc-label">${dcRate !== null ? rateLabel(dcRate) : 'Rare combo'}</div>
        </div>
      </div>
      <div style="text-align:center;font-size:13px;color:var(--text2)">
        ${dcRate !== null ? `This combination appeared in our 257-person dataset with a ${dcRate}% success correlation.` : 'This combination is rare in our dataset ‚Äî insufficient data for a reliable rating.'}
      </div>
    </div>

    <div class="name-breakdown">
      <div class="card-title">Name Vibration Analysis ‚Äî "${name}"</div>
      <table class="name-table">
        <thead>
          <tr><th>Component</th><th>Number</th><th>Planet</th><th>Success Rate</th><th>Strength</th></tr>
        </thead>
        <tbody>
          <tr>
            <td>Name Root (total)</td>
            <td class="mono">${cn.root}${cn.root !== reduce(cn.total) ? '' : ''}</td>
            <td>${getPlanet(cn.root)}</td>
            <td><span class="card-rate ${rateClass(nameRootRate)}">${nameRootRate}%</span></td>
            <td><div class="meter"><div class="meter-fill" style="width:${nameRootRate}%;background:${meterColor(nameRootRate)}"></div></div></td>
          </tr>
          <tr>
            <td>Soul Urge (vowels)</td>
            <td class="mono">${cn.soul}</td>
            <td>${getPlanet(cn.soul)}</td>
            <td><span class="card-rate ${rateClass(soulRate)}">${soulRate}%</span></td>
            <td><div class="meter"><div class="meter-fill" style="width:${soulRate}%;background:${meterColor(soulRate)}"></div></div></td>
          </tr>
          <tr>
            <td>Personality (consonants)</td>
            <td class="mono">${cn.pers}</td>
            <td>${getPlanet(cn.pers)}</td>
            <td><span class="card-rate ${rateClass(persRate)}">${persRate}%</span></td>
            <td><div class="meter"><div class="meter-fill" style="width:${persRate}%;background:${meterColor(persRate)}"></div></div></td>
          </tr>
          <tr>
            <td>Compound Number</td>
            <td class="mono" style="color:var(--gold)">${cn.total}</td>
            <td colspan="3" style="font-size:13px;color:var(--text2)">The unreduced total carries occult significance in Chaldean tradition</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="suggest-section">
      <div class="card-title">üí° Optimal Name Root Numbers for Your DOB</div>
      <div style="font-size:13px;color:var(--text2);margin-top:4px">Based on success rates ‚Äî which name root numbers perform best statistically</div>
      <div class="suggest-grid">
        ${bestRoots.map((r, i) => `
          <div class="suggest-chip ${i < 3 ? 'best' : ''}">
            <div style="font-size:20px;font-family:'Cormorant Garamond',serif">${r.root}</div>
            <div style="font-size:10px;margin-top:2px">${r.rate}%</div>
          </div>
        `).join('')}
      </div>
      <div style="margin-top:12px;font-size:12px;color:var(--text2)">
        Your current name root is <strong style="color:var(--gold)">${cn.root}</strong> (${nameRootRate}%). 
        ${nameRootRate >= 70 ? '‚úÖ Already in the optimal range!' : `Consider name variations that reduce to root ${bestRoots[0].root} or ${bestRoots[1].root} for better alignment.`}
      </div>
    </div>

    <div class="reco-section">
      <div class="card-title">üìä Data-Backed Insights</div>
      ${recos.map(r => `
        <div class="reco-item">
          <div class="reco-icon ${r.type === 'good' ? 'reco-good' : r.type === 'warn' ? 'reco-warn' : 'reco-info'}">
            ${r.type === 'good' ? '‚úì' : r.type === 'warn' ? '!' : '‚Ñπ'}
          </div>
          <div class="reco-text">${r.text}</div>
        </div>
      `).join('')}
    </div>

    ${buildCorrectionHTML(name)}

    <div class="disclaimer">
      <strong>Methodology & Disclaimer</strong><br>
      Success rates derived from analysis of 257 historically documented individuals across business, politics, sports, entertainment, and science.
      "Success rate" means the percentage of people with that number who achieved sustained positive outcomes in our dataset.
      Numerology provides patterns and tendencies, not certainties. Individual outcomes depend on countless factors beyond numbers.
      This tool is for educational and self-reflection purposes. All data is processed locally in your browser.
    </div>
  `;

  const el = document.getElementById('results');
  el.innerHTML = html;
  el.classList.add('active');
  el.scrollIntoView({ behavior: 'smooth', block: 'start' });
}
</script>
</body>
</html>
